/**
 * Kyo Design System - 单一真相源
 * 
 * 三层缩放架构：
 * 1. --device-scale: 设备层（CSS 媒体查询自动设置，无 JS 时序问题）
 * 2. --theme-scale: 主题层（CSS 覆盖）
 * 3. --user-scale: 用户层（偏好设定）
 * 
 * 缩放公式: font-size = 16px × device-scale × theme-scale × user-scale
 * 
 * [PROTOCOL]: 变更时更新此头部，然后检查 CLAUDE.md
 */

:root {
  /* ═══════════════════════════════════════════════════════════════════════════
   * 三层缩放系统
   * ═══════════════════════════════════════════════════════════════════════════ */
  --device-scale: 1;      /* 设备层: CSS 媒体查询自动设置 (phone=1.25, tablet=1.1, desktop=1) */
  --theme-scale: 1;       /* 主题覆盖: XP/98=1.1, Aqua=1 */
  --user-scale: 1;        /* 用户自定义: 系统偏好设定滑块 */
  
  /* 最终缩放值 = device × theme × user */
  --os-scale: calc(var(--device-scale) * var(--theme-scale) * var(--user-scale));
  
  /* ═══════════════════════════════════════════════════════════════════════════
   * 根 font-size 缩放 - 单一真相源
   * Tailwind 的所有 rem 单位自动跟随缩放
   * ═══════════════════════════════════════════════════════════════════════════ */
  font-size: calc(16px * var(--os-scale));
}

/* ═══════════════════════════════════════════════════════════════════════════════
 * 设备层缩放 - 纯 CSS 媒体查询 (无 JS 时序问题)
 * ═══════════════════════════════════════════════════════════════════════════════ */

/* Phone: < 768px → 1.25x 放大，触摸友好 */
@media (max-width: 767px) {
  :root {
    --device-scale: 1.25;
  }
}

/* Tablet: 768px - 1023px → 1.1x 放大 */
@media (min-width: 768px) and (max-width: 1023px) {
  :root {
    --device-scale: 1.1;
  }
}

/* Desktop: >= 1024px → 1.0x 基准 (默认值，无需覆盖) */

/* ═══════════════════════════════════════════════════════════════════════════════
 * 基准尺寸（Desktop Aqua 为基准 = 1.0）
 * ═══════════════════════════════════════════════════════════════════════════════ */
:root {
  
  /* 布局 */
  --base-dock-height: 56px;
  --base-dock-icon: 48px;
  --base-taskbar-height: 30px;
  --base-titlebar-height: 22px;
  --base-menubar-height: 22px;
  
  /* 图标 */
  --base-icon-desktop: 40px;
  --base-icon-menu: 24px;
  --base-icon-taskbar: 16px;
  --base-icon-titlebar: 16px;
  --base-icon-bookmark: 48px;      /* 书签板图标 */
  --base-traffic-light: 13px;      /* 红绿灯按钮 */
  --base-icon-apple: 30px;         /* 菜单栏苹果图标 */
  
  /* 字体 */
  --base-text-xs: 11px;
  --base-text-sm: 12px;
  --base-text-base: 13px;
  --base-text-lg: 14px;
  --base-text-xl: 16px;
  
  /* 间距 */
  --base-spacing-xs: 4px;
  --base-spacing-sm: 8px;
  --base-spacing-md: 12px;
  --base-spacing-lg: 16px;
  --base-spacing-xl: 24px;

  /* ═══════════════════════════════════════════════════════════════════════════
   * 计算后的实际尺寸（组件使用这些变量）
   * ═══════════════════════════════════════════════════════════════════════════ */
  
  /* 布局 */
  --os-dock-height: calc(var(--base-dock-height) * var(--os-scale));
  --os-dock-icon: calc(var(--base-dock-icon) * var(--os-scale));
  --os-taskbar-height: calc(var(--base-taskbar-height) * var(--os-scale));
  --os-titlebar-height: calc(var(--base-titlebar-height) * var(--os-scale));
  --os-menubar-height: calc(var(--base-menubar-height) * var(--os-scale));
  
  /* 图标 */
  --os-icon-desktop: calc(var(--base-icon-desktop) * var(--os-scale));
  --os-icon-menu: calc(var(--base-icon-menu) * var(--os-scale));
  --os-icon-taskbar: calc(var(--base-icon-taskbar) * var(--os-scale));
  --os-icon-titlebar: calc(var(--base-icon-titlebar) * var(--os-scale));
  --os-icon-bookmark: calc(var(--base-icon-bookmark) * var(--os-scale));
  --os-traffic-light: calc(var(--base-traffic-light) * var(--os-scale));
  --os-icon-apple: calc(var(--base-icon-apple) * var(--os-scale));
  
  /* 字体 */
  --os-text-xs: calc(var(--base-text-xs) * var(--os-scale));
  --os-text-sm: calc(var(--base-text-sm) * var(--os-scale));
  --os-text-base: calc(var(--base-text-base) * var(--os-scale));
  --os-text-lg: calc(var(--base-text-lg) * var(--os-scale));
  --os-text-xl: calc(var(--base-text-xl) * var(--os-scale));
  
  /* 间距 */
  --os-spacing-xs: calc(var(--base-spacing-xs) * var(--os-scale));
  --os-spacing-sm: calc(var(--base-spacing-sm) * var(--os-scale));
  --os-spacing-md: calc(var(--base-spacing-md) * var(--os-scale));
  --os-spacing-lg: calc(var(--base-spacing-lg) * var(--os-scale));
  --os-spacing-xl: calc(var(--base-spacing-xl) * var(--os-scale));
}

/* ═══════════════════════════════════════════════════════════════════════════════
 * 主题层覆盖
 * ═══════════════════════════════════════════════════════════════════════════════ */

/* XP/98: 复古主题，基础比例稍大 */
:root[data-os-theme="xp"],
:root[data-os-theme="win98"] {
  --theme-scale: 1.1;
  
  /* XP/98 特有的基准覆盖 */
  --base-taskbar-height: 40px;
  --base-titlebar-height: 28px;
  --base-icon-desktop: 48px;
  --base-icon-menu: 32px;
  --base-icon-taskbar: 20px;
  --base-text-base: 13px;
}

/* macOS Aqua: 现代 Mac，基准比例 */
:root[data-os-theme="macosx"] {
  --theme-scale: 1;
}

/* ═══════════════════════════════════════════════════════════════════════════════
 * 图标样式系统 - 每个主题独立定义
 * ═══════════════════════════════════════════════════════════════════════════════ */

/* 默认/Aqua: 圆角玻璃质感 */
:root {
  --os-icon-radius: 12px;
  --os-icon-border: none;
  --os-icon-shadow: 0 2px 8px rgba(0, 0, 0, 0.12), 0 1px 3px rgba(0, 0, 0, 0.08);
  --os-icon-filter: none;
  --os-icon-bg: white;
  --os-icon-padding: 0;
  /* 容器样式 */
  --os-icon-container-bg: linear-gradient(to bottom, white, rgba(255,255,255,0.95));
  --os-icon-container-border: 1px solid rgba(0, 0, 0, 0.1);
  /* 悬停效果 */
  --os-icon-hover-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
  --os-icon-hover-transform: scale(1.02);
}

/* macOS Aqua: 水晶质感、圆角、柔和阴影 */
:root[data-os-theme="macosx"] {
  --os-icon-radius: 12px;
  --os-icon-border: 1px solid rgba(0, 0, 0, 0.1);
  --os-icon-shadow: 0 2px 8px rgba(0, 0, 0, 0.12), 0 1px 3px rgba(0, 0, 0, 0.08);
  --os-icon-filter: none;
  --os-icon-bg: white;
  --os-icon-container-bg: linear-gradient(to bottom, white, rgba(255,255,255,0.95));
  --os-icon-container-border: 1px solid rgba(0, 0, 0, 0.1);
  --os-icon-hover-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
  --os-icon-hover-transform: scale(1.02);
}

/* Windows XP: Luna 蓝调、轻微阴影、无圆角 */
:root[data-os-theme="xp"] {
  --os-icon-radius: 0;
  --os-icon-border: none;
  --os-icon-shadow: 2px 2px 4px rgba(0, 0, 0, 0.25);
  --os-icon-filter: none;
  --os-icon-bg: transparent;
  --os-icon-container-bg: transparent;
  --os-icon-container-border: none;
  --os-icon-hover-shadow: 2px 2px 6px rgba(0, 0, 0, 0.35);
  --os-icon-hover-transform: none;
}

/* Windows 98: 经典 3D 凸起效果、无圆角 */
:root[data-os-theme="win98"] {
  --os-icon-radius: 0;
  --os-icon-border: none;
  --os-icon-shadow: none;
  --os-icon-filter: none;
  --os-icon-bg: transparent;
  --os-icon-container-bg: transparent;
  --os-icon-container-border: none;
  --os-icon-hover-shadow: none;
  --os-icon-hover-transform: none;
}

/* ═══════════════════════════════════════════════════════════════════════════════
 * iOS PWA Standalone 模式 - 黑色背景融合灵动岛
 * ═══════════════════════════════════════════════════════════════════════════════ */
@media all and (display-mode: standalone) {
  html, body {
    background-color: #000000 !important;
  }
}

/* iOS Safari standalone 模式备用检测 */
@supports (-webkit-touch-callout: none) {
  @media (display-mode: standalone) {
    html, body {
      background-color: #000000 !important;
    }
  }
}
